<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>üõ°Ô∏è Setting Up an OpenVPN Server with EasyRSA 3 | Personal Blog ü¶∑</title>
<meta name=keywords content="OpenVPN,VPN,EasyRSA,Security,Linux"><meta name=description content="In this post, we will walk through the steps of setting up an OpenVPN server on
an Ubuntu 20.04, 22.04 or 24.04 machine (it should work for older versions as well ü§û). Additionally, we will provide some context around VPNs,
EasyRSA, and the cryptographic mechanisms involved in the process.
Introduction to VPN and OpenVPN
A VPN, or Virtual Private Network, is a technology that allows you to create
a secure connection over the internet. OpenVPN is an open-source VPN protocol
that is widely used for creating VPN servers and clients."><meta name=author content="thetooth"><link rel=canonical href=https://thetooth.io/blog/openvpn-server-setup/><link crossorigin=anonymous href=/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css integrity="sha256-1vzSCk+4bvpN+sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as=style><link rel=icon href=https://thetooth.io/images/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://thetooth.io/images/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://thetooth.io/images/favicon-32x32.png><link rel=apple-touch-icon href=https://thetooth.io/images/apple-touch-icon.png><link rel=mask-icon href=https://thetooth.io/images/favicon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://thetooth.io/blog/openvpn-server-setup/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","pixhdg0w82")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-255TE7PF8E"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-255TE7PF8E")}</script><meta property="og:url" content="https://thetooth.io/blog/openvpn-server-setup/"><meta property="og:site_name" content="Personal Blog ü¶∑"><meta property="og:title" content="üõ°Ô∏è Setting Up an OpenVPN Server with EasyRSA 3"><meta property="og:description" content="In this post, we will walk through the steps of setting up an OpenVPN server on an Ubuntu 20.04, 22.04 or 24.04 machine (it should work for older versions as well ü§û). Additionally, we will provide some context around VPNs, EasyRSA, and the cryptographic mechanisms involved in the process.
Introduction to VPN and OpenVPN A VPN, or Virtual Private Network, is a technology that allows you to create a secure connection over the internet. OpenVPN is an open-source VPN protocol that is widely used for creating VPN servers and clients."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2023-10-25T16:26:07+03:00"><meta property="article:modified_time" content="2023-10-25T16:26:07+03:00"><meta property="article:tag" content="OpenVPN"><meta property="article:tag" content="VPN"><meta property="article:tag" content="EasyRSA"><meta property="article:tag" content="Security"><meta property="article:tag" content="Linux"><meta property="og:image" content="https://thetooth.io/images/openvpn-easy-rsa-hero-image-min.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://thetooth.io/images/openvpn-easy-rsa-hero-image-min.png"><meta name=twitter:title content="üõ°Ô∏è Setting Up an OpenVPN Server with EasyRSA 3"><meta name=twitter:description content="In this post, we will walk through the steps of setting up an OpenVPN server on
an Ubuntu 20.04, 22.04 or 24.04 machine (it should work for older versions as well ü§û). Additionally, we will provide some context around VPNs,
EasyRSA, and the cryptographic mechanisms involved in the process.
Introduction to VPN and OpenVPN
A VPN, or Virtual Private Network, is a technology that allows you to create
a secure connection over the internet. OpenVPN is an open-source VPN protocol
that is widely used for creating VPN servers and clients."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blogs","item":"https://thetooth.io/blog/"},{"@type":"ListItem","position":2,"name":"üõ°Ô∏è Setting Up an OpenVPN Server with EasyRSA 3","item":"https://thetooth.io/blog/openvpn-server-setup/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"üõ°Ô∏è Setting Up an OpenVPN Server with EasyRSA 3","name":"üõ°Ô∏è Setting Up an OpenVPN Server with EasyRSA 3","description":"In this post, we will walk through the steps of setting up an OpenVPN server on an Ubuntu 20.04, 22.04 or 24.04 machine (it should work for older versions as well ü§û). Additionally, we will provide some context around VPNs, EasyRSA, and the cryptographic mechanisms involved in the process.\nIntroduction to VPN and OpenVPN A VPN, or Virtual Private Network, is a technology that allows you to create a secure connection over the internet. OpenVPN is an open-source VPN protocol that is widely used for creating VPN servers and clients.\n","keywords":["OpenVPN","VPN","EasyRSA","Security","Linux"],"articleBody":"In this post, we will walk through the steps of setting up an OpenVPN server on an Ubuntu 20.04, 22.04 or 24.04 machine (it should work for older versions as well ü§û). Additionally, we will provide some context around VPNs, EasyRSA, and the cryptographic mechanisms involved in the process.\nIntroduction to VPN and OpenVPN A VPN, or Virtual Private Network, is a technology that allows you to create a secure connection over the internet. OpenVPN is an open-source VPN protocol that is widely used for creating VPN servers and clients.\nEasyRSA EasyRSA is a command-line tool that is used for managing Public Key Infrastructure (PKI). In the context of OpenVPN, EasyRSA is used to create and manage the cryptographic keys and certificates that are required for a secure VPN connection.\nSetting Up an OpenVPN Server with EasyRSA 3 Here are the steps to set up an OpenVPN server with EasyRSA 3 on an Ubuntu 20.04 server.\nStep 1: Install OpenVPN and EasyRSA sudo apt update sudo apt install -y openvpn easy-rsa Step 2: Set Up the EasyRSA Public Key Infrastructure (PKI) make-cadir ~/easy-rsa cd ~/easy-rsa Step 3: Initialize the PKI ./easyrsa init-pki Step 4: Generate the Certificate Authority (CA) Certificate and Key ./easyrsa build-ca Step 5: Generate the Server Certificate and Key ./easyrsa gen-req server Step 6: Sign the Server Certificate with the CA Certificate ./easyrsa sign-req server server Step 7: Generate Diffie-Hellman Parameters ./easyrsa gen-dh Step 8: Generate the TLS Auth Key openvpn --genkey --secret ta.key Step 9: Copy the Certificates and Keys to the OpenVPN Server Directory sudo cp pki/ca.crt /etc/openvpn/ sudo cp pki/issued/server.crt /etc/openvpn/ sudo cp pki/private/server.key /etc/openvpn/ sudo cp pki/dh.pem /etc/openvpn/ sudo cp ta.key /etc/openvpn/ Step 10: Create the OpenVPN Server Configuration File Create a new file at /etc/openvpn/server.conf and add the following content, modifying it according to your needs:\n# the port number on which the server will listen for incoming VPN connections port 1194 # the protocol to be used for the VPN connection (either udp or tcp) proto udp # specifies that we are using a routed tunnel interface dev tun # path to the Certificate Authority (CA) certificate ca /path/to/ca.crt # path to the server's certificate cert /path/to/server.crt # path to the server's private key key /path/to/server.key # path to the Diffie-Hellman parameters file dh /path/to/dh.pem # path to the TLS authentication key and its direction (0 = server, 1 = client) tls-auth /path/to/ta.key 0 # the IP address range to be used for client VPN connections server 10.8.0.0 255.255.255.0 # file to persistently store the IP addresses of connected clients ifconfig-pool-persist ipp.txt # push options to redirect the client's default gateway, bypassing DHCP push \"redirect-gateway def1 bypass-dhcp\" # push options to specify the DNS servers to be used by the VPN clients push \"dhcp-option DNS 8.8.8.8\" push \"dhcp-option DNS 8.8.4.4\" # allow communication between VPN clients client-to-client # allow multiple clients to connect with the same certificate duplicate-cn # keepalive ping and timeout keepalive 10 120 # encryption cipher to be used for the VPN connection cipher AES-256-CBC # hash algorithm to be used for HMAC authentication auth SHA256 # user and group to drop privileges to after startup user nobody group nogroup # persist the key across tunnel restarts persist-key # persist the tunnel device across tunnel restarts persist-tun # path to the log file for connection status status openvpn-status.log # verbosity level of OpenVPN log output (3 is the default) verb 3 # notify the client to exit when the VPN connection is terminated explicit-exit-notify 1 Step 11: Start the OpenVPN Server sudo systemctl start openvpn@server sudo systemctl enable openvpn@server Your OpenVPN server is now up and running! The next steps would be to generate client certificates and configure the OpenVPN client accordingly.\nStep 12: Configure OpenVPN Client For each client, you will need to create a client certificate and key. Follow these steps to configure the OpenVPN client.\nBuild the client certificate and key: ./easyrsa build-client-full nopass Create a new OpenVPN client configuration file: sudo vim .ovpn You have two options to create the client OpenVPN configuration (.ovpn) - standard and portable.\nStandard - the standard one refers to the ca cert, client cert, client key, tls-auth key as separate files. Here is a basic configuration: # configures the OpenVPN client mode client # specifies that we are using a routed tunnel interface dev tun # specifies that we are using the UDP protocol. (TCP is supported as well) # Both server and client need to match protocol (either UDP or TCP) proto udp # specifies the IP address and port of the OpenVPN server. 1194 is the standard port for UDP remote YOUR_SERVER_IP 1194 # specifies that the client should keep trying to resolve the server IP indefinitely resolv-retry infinite # allows the client to choose any available UDP port nobind # user that the client will run the openvpn client user nobody # group that the client will run the openvpn client group nogroup # persists the key across tunnel restarts persist-key # persists the tunnel device across tunnel restarts persist-tun # links to the CA certificate ca /path/to/ca.crt # links to the client certificate cert /path/to/.crt # links to the client private key (NOTE: Keep the key in secret) key /path/to/.key # The TLS authentication key adds an extra layer of HMAC authentication to the TLS control channel tls-auth /path/to/ta.key 1 # ensures that the server certificate was signed by a trusted CA (specified in the ca option) remote-cert-tls server # specifies the encryption cipher to be used for the VPN connection cipher AES-256-CBC # specifies the hash algorithm to be used for HMAC authentication auth SHA256 # specifies the verbosity level of OpenVPN log output verb 3 Portable - the portable one embeds the ca cert, client cert, client key, tls-auth key in the ovpn config file so you can move it around without the need to copy other files as well. Here is a basic configuration: # configures the OpenVPN client mode client # specifies that we are using a routed tunnel interface dev tun # specifies that we are using the UDP protocol. (TCP is supported as well) # Both server and client need to match protocol (either UDP or TCP) proto udp # specifies the IP address and port of the OpenVPN server. 1194 is the standard port for UDP remote YOUR_SERVER_IP 1194 # specifies that the client should keep trying to resolve the server IP indefinitely resolv-retry infinite # allows the client to choose any available UDP port nobind # user that the client will run the openvpn client user nobody # group that the client will run the openvpn client group nogroup # persists the key across tunnel restarts persist-key # persists the tunnel device across tunnel restarts persist-tun # ensures that the server certificate was signed by a trusted CA (specified in the ca option) remote-cert-tls server # specifies the encryption cipher to be used for the VPN connection cipher AES-256-CBC # specifies the hash algorithm to be used for HMAC authentication auth SHA256 # specifies the verbosity level of OpenVPN log output verb 3 # links to the CA certificate # embed the Certificate Authority certificate # insert the contents of your ca.crt file here /path/to/pki/ca.cert # links to the client certificate # embed the client certificate # insert the contents of your /path/to/pki/issued/.crt here # links to the client private key # embed the client key # insert the contents of your /path/to/pki/private/.key file here # the TLS authentication key adds an extra layer of HMAC authentication to the TLS control channel # embed the TLS authentication key for additional security # insert the contents of your /path/to/openvpn-ca/ta.key file here # this tells OpenVPN that the ta.key is embedded in the configuration file # and should be used for HMAC authentication as a client. tls-auth inline 1 Save and exit. Download the .ovpn configuration and use some of the popular vpn clients that support OpenVPN: Windows Linux MacOS, TunnelBlick, Viscosity Now you are good to go! You can surf the internet securely.\n(Optional) Gift If you don‚Äôt want to re-read this tutorial to issue client configurations once in a while because you don‚Äôt remember and command exec sequence, here is a quick Makefile that will simplify the creation of a client configuration.\nGo to /path/to/openvpn-ca vim Makefile Paste the following content: SHELL := /bin/bash CLIENT ?= client1 EASYRSA_DIR ?= . PKI_DIR ?= $(EASYRSA_DIR)/pki TA_KEY ?= $(EASYRSA_DIR)/ta.key OUTPUT_DIR ?= $(EASYRSA_DIR)/clients OVPN_TEMPLATE ?= $(OUTPUT_DIR)/client.ovpn.template .PHONY: help client help: @echo \"Usage:\" @echo \" make client CLIENT=\" @echo \" Generates an OpenVPN client configuration file for the specified client.\" @echo \" If is not provided, 'client1' is used as the default.\" client: @mkdir -p $(OUTPUT_DIR) @$(EASYRSA_DIR)/easyrsa build-client-full $(CLIENT) nopass @cat $(OVPN_TEMPLATE) \u003e $(OUTPUT_DIR)/$(CLIENT).ovpn @echo -e \"\\n$$(cat $(PKI_DIR)/ca.crt)\\n\\n\\n$$(cat $(PKI_DIR)/issued/$(CLIENT).crt)\\n\\n\\n$$(cat $(PKI_DIR)/private/$(CLIENT).key)\\n\\n\\n$$(cat $(TA_KEY))\\n\" \u003e\u003e $(OUTPUT_DIR)/$(CLIENT).ovpn @echo \"Client configuration for $(CLIENT) created at $(OUTPUT_DIR)/$(CLIENT).ovpn\" default: help Save and exit Whenever you need to issue a new client configuration you can just run:\nmake client CLIENT= If you forget the make client CLIENT= command execution, just run make and it will print you the help section.\nTroubleshooting If you receive similar messages on the server side: ovpn-server[460342]: Authenticate/Decrypt packet error: packet HMAC authentication failed ovpn-server[460342]: TLS Error: incoming packet authentication failed from [AF_INET]: Most probably the client configuration around tls-auth is not configured correctly. Make sure that the client tls-auth option is set to 1 and the server tls-auth is set to 0.\n","wordCount":"1588","inLanguage":"en","image":"https://thetooth.io/images/openvpn-easy-rsa-hero-image-min.png","datePublished":"2023-10-25T16:26:07+03:00","dateModified":"2023-10-25T16:26:07+03:00","author":{"@type":"Person","name":"thetooth"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://thetooth.io/blog/openvpn-server-setup/"},"publisher":{"@type":"Organization","name":"Personal Blog ü¶∑","logo":{"@type":"ImageObject","url":"https://thetooth.io/images/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://thetooth.io/ accesskey=h title="Home (Alt + H)"><img src=https://thetooth.io/images/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://thetooth.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://thetooth.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://thetooth.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://thetooth.io/archive/ title=Archive><span>Archive</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://thetooth.io/>Home</a>&nbsp;¬ª&nbsp;<a href=https://thetooth.io/blog/>Blogs</a></div><h1 class="post-title entry-hint-parent">üõ°Ô∏è Setting Up an OpenVPN Server with EasyRSA 3</h1><div class=post-meta><span title='2023-10-25 16:26:07 +0300 +0300'>October 25, 2023</span>&nbsp;¬∑&nbsp;8 min&nbsp;¬∑&nbsp;thetooth</div></header><figure class=entry-cover><img loading=eager src=https://thetooth.io/images/openvpn-easy-rsa-hero-image-min.png alt></figure><div class=post-content><p>In this post, we will walk through the steps of setting up an OpenVPN server on
an Ubuntu 20.04, 22.04 or 24.04 machine (it should work for older versions as well ü§û). Additionally, we will provide some context around VPNs,
EasyRSA, and the cryptographic mechanisms involved in the process.</p><h2 id=introduction-to-vpn-and-openvpn>Introduction to VPN and OpenVPN<a hidden class=anchor aria-hidden=true href=#introduction-to-vpn-and-openvpn>#</a></h2><p>A VPN, or Virtual Private Network, is a technology that allows you to create
a secure connection over the internet. OpenVPN is an open-source VPN protocol
that is widely used for creating VPN servers and clients.</p><p><img alt="VPN connection" loading=lazy src=/images/vpn_connection_diagram-min.png></p><h2 id=easyrsa>EasyRSA<a hidden class=anchor aria-hidden=true href=#easyrsa>#</a></h2><p>EasyRSA is a command-line tool that is used for managing Public Key Infrastructure (PKI).
In the context of OpenVPN, EasyRSA is used to create and manage the
cryptographic keys and certificates that are required for a secure VPN connection.</p><h2 id=setting-up-an-openvpn-server-with-easyrsa-3>Setting Up an OpenVPN Server with EasyRSA 3<a hidden class=anchor aria-hidden=true href=#setting-up-an-openvpn-server-with-easyrsa-3>#</a></h2><p>Here are the steps to set up an OpenVPN server with EasyRSA 3 on an Ubuntu 20.04 server.</p><h3 id=step-1-install-openvpn-and-easyrsa>Step 1: Install OpenVPN and EasyRSA<a hidden class=anchor aria-hidden=true href=#step-1-install-openvpn-and-easyrsa>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo apt update
</span></span><span style=display:flex><span>sudo apt install -y openvpn easy-rsa
</span></span></code></pre></div><h3 id=step-2-set-up-the-easyrsa-public-key-infrastructure-pki>Step 2: Set Up the EasyRSA Public Key Infrastructure (PKI)<a hidden class=anchor aria-hidden=true href=#step-2-set-up-the-easyrsa-public-key-infrastructure-pki>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>make-cadir ~/easy-rsa
</span></span><span style=display:flex><span>cd ~/easy-rsa
</span></span></code></pre></div><h3 id=step-3-initialize-the-pki>Step 3: Initialize the PKI<a hidden class=anchor aria-hidden=true href=#step-3-initialize-the-pki>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>./easyrsa init-pki
</span></span></code></pre></div><h3 id=step-4-generate-the-certificate-authority-ca-certificate-and-key>Step 4: Generate the Certificate Authority (CA) Certificate and Key<a hidden class=anchor aria-hidden=true href=#step-4-generate-the-certificate-authority-ca-certificate-and-key>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>./easyrsa build-ca
</span></span></code></pre></div><h3 id=step-5-generate-the-server-certificate-and-key>Step 5: Generate the Server Certificate and Key<a hidden class=anchor aria-hidden=true href=#step-5-generate-the-server-certificate-and-key>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>./easyrsa gen-req server
</span></span></code></pre></div><h3 id=step-6-sign-the-server-certificate-with-the-ca-certificate>Step 6: Sign the Server Certificate with the CA Certificate<a hidden class=anchor aria-hidden=true href=#step-6-sign-the-server-certificate-with-the-ca-certificate>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>./easyrsa sign-req server server
</span></span></code></pre></div><h3 id=step-7-generate-diffie-hellman-parameters>Step 7: Generate Diffie-Hellman Parameters<a hidden class=anchor aria-hidden=true href=#step-7-generate-diffie-hellman-parameters>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>./easyrsa gen-dh
</span></span></code></pre></div><h3 id=step-8-generate-the-tls-auth-key>Step 8: Generate the TLS Auth Key<a hidden class=anchor aria-hidden=true href=#step-8-generate-the-tls-auth-key>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>openvpn --genkey --secret ta.key
</span></span></code></pre></div><h3 id=step-9-copy-the-certificates-and-keys-to-the-openvpn-server-directory>Step 9: Copy the Certificates and Keys to the OpenVPN Server Directory<a hidden class=anchor aria-hidden=true href=#step-9-copy-the-certificates-and-keys-to-the-openvpn-server-directory>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo cp pki/ca.crt /etc/openvpn/
</span></span><span style=display:flex><span>sudo cp pki/issued/server.crt /etc/openvpn/
</span></span><span style=display:flex><span>sudo cp pki/private/server.key /etc/openvpn/
</span></span><span style=display:flex><span>sudo cp pki/dh.pem /etc/openvpn/
</span></span><span style=display:flex><span>sudo cp ta.key /etc/openvpn/
</span></span></code></pre></div><h3 id=step-10-create-the-openvpn-server-configuration-file>Step 10: Create the OpenVPN Server Configuration File<a hidden class=anchor aria-hidden=true href=#step-10-create-the-openvpn-server-configuration-file>#</a></h3><p>Create a new file at <code>/etc/openvpn/server.conf</code> and add the following content,
modifying it according to your needs:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># the port number on which the server will listen for incoming VPN connections</span>
</span></span><span style=display:flex><span>port <span style=color:#ae81ff>1194</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># the protocol to be used for the VPN connection (either udp or tcp)</span>
</span></span><span style=display:flex><span>proto udp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># specifies that we are using a routed tunnel interface</span>
</span></span><span style=display:flex><span>dev tun
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># path to the Certificate Authority (CA) certificate</span>
</span></span><span style=display:flex><span>ca /path/to/ca.crt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># path to the server&#39;s certificate</span>
</span></span><span style=display:flex><span>cert /path/to/server.crt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># path to the server&#39;s private key</span>
</span></span><span style=display:flex><span>key /path/to/server.key
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># path to the Diffie-Hellman parameters file</span>
</span></span><span style=display:flex><span>dh /path/to/dh.pem
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># path to the TLS authentication key and its direction (0 = server, 1 = client)</span>
</span></span><span style=display:flex><span>tls-auth /path/to/ta.key <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># the IP address range to be used for client VPN connections</span>
</span></span><span style=display:flex><span>server 10.8.0.0 255.255.255.0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># file to persistently store the IP addresses of connected clients</span>
</span></span><span style=display:flex><span>ifconfig-pool-persist ipp.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># push options to redirect the client&#39;s default gateway, bypassing DHCP</span>
</span></span><span style=display:flex><span>push <span style=color:#e6db74>&#34;redirect-gateway def1 bypass-dhcp&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># push options to specify the DNS servers to be used by the VPN clients</span>
</span></span><span style=display:flex><span>push <span style=color:#e6db74>&#34;dhcp-option DNS 8.8.8.8&#34;</span>
</span></span><span style=display:flex><span>push <span style=color:#e6db74>&#34;dhcp-option DNS 8.8.4.4&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># allow communication between VPN clients</span>
</span></span><span style=display:flex><span>client-to-client
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># allow multiple clients to connect with the same certificate</span>
</span></span><span style=display:flex><span>duplicate-cn
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># keepalive ping and timeout</span>
</span></span><span style=display:flex><span>keepalive <span style=color:#ae81ff>10</span> <span style=color:#ae81ff>120</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># encryption cipher to be used for the VPN connection</span>
</span></span><span style=display:flex><span>cipher AES-256-CBC
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># hash algorithm to be used for HMAC authentication</span>
</span></span><span style=display:flex><span>auth SHA256
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># user and group to drop privileges to after startup</span>
</span></span><span style=display:flex><span>user nobody
</span></span><span style=display:flex><span>group nogroup
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># persist the key across tunnel restarts</span>
</span></span><span style=display:flex><span>persist-key
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># persist the tunnel device across tunnel restarts</span>
</span></span><span style=display:flex><span>persist-tun
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># path to the log file for connection status</span>
</span></span><span style=display:flex><span>status openvpn-status.log
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># verbosity level of OpenVPN log output (3 is the default)</span>
</span></span><span style=display:flex><span>verb <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># notify the client to exit when the VPN connection is terminated</span>
</span></span><span style=display:flex><span>explicit-exit-notify <span style=color:#ae81ff>1</span>
</span></span></code></pre></div><h3 id=step-11-start-the-openvpn-server>Step 11: Start the OpenVPN Server<a hidden class=anchor aria-hidden=true href=#step-11-start-the-openvpn-server>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo systemctl start openvpn@server
</span></span><span style=display:flex><span>sudo systemctl enable openvpn@server
</span></span></code></pre></div><p>Your OpenVPN server is now up and running!
The next steps would be to generate client certificates and configure the OpenVPN client accordingly.</p><h3 id=step-12-configure-openvpn-client>Step 12: Configure OpenVPN Client<a hidden class=anchor aria-hidden=true href=#step-12-configure-openvpn-client>#</a></h3><p>For each client, you will need to create a client certificate and key. Follow these steps to configure the OpenVPN client.</p><ol><li>Build the client certificate and key:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>./easyrsa build-client-full &lt;name&gt; nopass
</span></span></code></pre></div><ol start=2><li>Create a new OpenVPN client configuration file:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo vim &lt;name&gt;.ovpn
</span></span></code></pre></div><p>You have two options to create the client OpenVPN configuration (<code>.ovpn</code>) - standard and portable.</p><ol start=3><li>Standard - the standard one refers to the <code>ca</code> cert, client <code>cert</code>, client <code>key</code>, <code>tls-auth</code> key
as separate files. Here is a basic configuration:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># configures the OpenVPN client mode</span>
</span></span><span style=display:flex><span>client
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># specifies that we are using a routed tunnel interface</span>
</span></span><span style=display:flex><span>dev tun
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># specifies that we are using the UDP protocol. (TCP is supported as well)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Both server and client need to match protocol (either UDP or TCP)</span>
</span></span><span style=display:flex><span>proto udp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># specifies the IP address and port of the OpenVPN server. 1194 is the standard port for UDP</span>
</span></span><span style=display:flex><span>remote YOUR_SERVER_IP <span style=color:#ae81ff>1194</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># specifies that the client should keep trying to resolve the server IP indefinitely</span>
</span></span><span style=display:flex><span>resolv-retry infinite
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># allows the client to choose any available UDP port</span>
</span></span><span style=display:flex><span>nobind
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># user that the client will run the openvpn client</span>
</span></span><span style=display:flex><span>user nobody
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># group that the client will run the openvpn client</span>
</span></span><span style=display:flex><span>group nogroup
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># persists the key across tunnel restarts</span>
</span></span><span style=display:flex><span>persist-key
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># persists the tunnel device across tunnel restarts</span>
</span></span><span style=display:flex><span>persist-tun
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># links to the CA certificate</span>
</span></span><span style=display:flex><span>ca /path/to/ca.crt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># links to the client certificate</span>
</span></span><span style=display:flex><span>cert /path/to/&lt;name&gt;.crt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># links to the client private key (NOTE: Keep the key in secret)</span>
</span></span><span style=display:flex><span>key /path/to/&lt;name&gt;.key
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># The TLS authentication key adds an extra layer of HMAC authentication to the TLS control channel</span>
</span></span><span style=display:flex><span>tls-auth /path/to/ta.key <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ensures that the server certificate was signed by a trusted CA (specified in the ca option)</span>
</span></span><span style=display:flex><span>remote-cert-tls server
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># specifies the encryption cipher to be used for the VPN connection</span>
</span></span><span style=display:flex><span>cipher AES-256-CBC
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># specifies the hash algorithm to be used for HMAC authentication</span>
</span></span><span style=display:flex><span>auth SHA256
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># specifies the verbosity level of OpenVPN log output</span>
</span></span><span style=display:flex><span>verb <span style=color:#ae81ff>3</span>
</span></span></code></pre></div><ol start=4><li>Portable - the portable one embeds the <code>ca</code> cert, client <code>cert</code>, client <code>key</code>, <code>tls-auth</code> key
in the <code>ovpn</code> config file so you can move it around without the need to copy other
files as well. Here is a basic configuration:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># configures the OpenVPN client mode</span>
</span></span><span style=display:flex><span>client
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># specifies that we are using a routed tunnel interface</span>
</span></span><span style=display:flex><span>dev tun
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># specifies that we are using the UDP protocol. (TCP is supported as well)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Both server and client need to match protocol (either UDP or TCP)</span>
</span></span><span style=display:flex><span>proto udp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># specifies the IP address and port of the OpenVPN server. 1194 is the standard port for UDP</span>
</span></span><span style=display:flex><span>remote YOUR_SERVER_IP <span style=color:#ae81ff>1194</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># specifies that the client should keep trying to resolve the server IP indefinitely</span>
</span></span><span style=display:flex><span>resolv-retry infinite
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># allows the client to choose any available UDP port</span>
</span></span><span style=display:flex><span>nobind
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># user that the client will run the openvpn client</span>
</span></span><span style=display:flex><span>user nobody
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># group that the client will run the openvpn client</span>
</span></span><span style=display:flex><span>group nogroup
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># persists the key across tunnel restarts</span>
</span></span><span style=display:flex><span>persist-key
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># persists the tunnel device across tunnel restarts</span>
</span></span><span style=display:flex><span>persist-tun
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ensures that the server certificate was signed by a trusted CA (specified in the ca option)</span>
</span></span><span style=display:flex><span>remote-cert-tls server
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># specifies the encryption cipher to be used for the VPN connection</span>
</span></span><span style=display:flex><span>cipher AES-256-CBC
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># specifies the hash algorithm to be used for HMAC authentication</span>
</span></span><span style=display:flex><span>auth SHA256
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># specifies the verbosity level of OpenVPN log output</span>
</span></span><span style=display:flex><span>verb <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># links to the CA certificate</span>
</span></span><span style=display:flex><span><span style=color:#75715e># embed the Certificate Authority certificate</span>
</span></span><span style=display:flex><span>&lt;ca&gt;
</span></span><span style=display:flex><span><span style=color:#75715e># insert the contents of your ca.crt file here /path/to/pki/ca.cert</span>
</span></span><span style=display:flex><span>&lt;/ca&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># links to the client certificate</span>
</span></span><span style=display:flex><span><span style=color:#75715e># embed the client certificate</span>
</span></span><span style=display:flex><span>&lt;cert&gt;
</span></span><span style=display:flex><span><span style=color:#75715e># insert the contents of your /path/to/pki/issued/&lt;name&gt;.crt here</span>
</span></span><span style=display:flex><span>&lt;/cert&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># links to the client private key</span>
</span></span><span style=display:flex><span><span style=color:#75715e># embed the client key</span>
</span></span><span style=display:flex><span>&lt;key&gt;
</span></span><span style=display:flex><span><span style=color:#75715e># insert the contents of your /path/to/pki/private/&lt;name&gt;.key file here</span>
</span></span><span style=display:flex><span>&lt;/key&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># the TLS authentication key adds an extra layer of HMAC authentication to the TLS control channel</span>
</span></span><span style=display:flex><span><span style=color:#75715e># embed the TLS authentication key for additional security</span>
</span></span><span style=display:flex><span>&lt;tls-auth&gt;
</span></span><span style=display:flex><span><span style=color:#75715e># insert the contents of your /path/to/openvpn-ca/ta.key file here</span>
</span></span><span style=display:flex><span>&lt;/tls-auth&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># this tells OpenVPN that the ta.key is embedded in the configuration file</span>
</span></span><span style=display:flex><span><span style=color:#75715e># and should be used for HMAC authentication as a client.</span>
</span></span><span style=display:flex><span>tls-auth inline <span style=color:#ae81ff>1</span>
</span></span></code></pre></div><ol start=5><li>Save and exit. Download the <code>&lt;name>.ovpn</code> configuration and use some of the
popular vpn clients that support OpenVPN:<ul><li><a href=https://openvpn.net/client/client-connect-vpn-for-windows/>Windows</a></li><li><a href=https://openvpn.net/cloud-docs/owner/connectors/connector-user-guides/openvpn-3-client-for-linux.html>Linux</a></li><li><a href=https://openvpn.net/client-connect-vpn-for-mac-os/>MacOS</a>, <a href=https://tunnelblick.net/>TunnelBlick</a>, <a href=https://www.sparklabs.com/viscosity/>Viscosity</a></li></ul></li></ol><p>Now you are good to go! You can surf the internet securely.</p><h2 id=optional-gift>(Optional) Gift<a hidden class=anchor aria-hidden=true href=#optional-gift>#</a></h2><p>If you don&rsquo;t want to re-read this tutorial to issue client configurations once
in a while because you don&rsquo;t remember and command exec sequence, here is a quick
<code>Makefile</code> that will simplify the creation of a client configuration.</p><ol><li>Go to <code>/path/to/openvpn-ca</code></li><li><code>vim Makefile</code></li><li>Paste the following content:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>SHELL :<span style=color:#f92672>=</span> /bin/bash
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>CLIENT ?<span style=color:#f92672>=</span> client1
</span></span><span style=display:flex><span>EASYRSA_DIR ?<span style=color:#f92672>=</span> .
</span></span><span style=display:flex><span>PKI_DIR ?<span style=color:#f92672>=</span> <span style=color:#66d9ef>$(</span>EASYRSA_DIR<span style=color:#66d9ef>)</span>/pki
</span></span><span style=display:flex><span>TA_KEY ?<span style=color:#f92672>=</span> <span style=color:#66d9ef>$(</span>EASYRSA_DIR<span style=color:#66d9ef>)</span>/ta.key
</span></span><span style=display:flex><span>OUTPUT_DIR ?<span style=color:#f92672>=</span> <span style=color:#66d9ef>$(</span>EASYRSA_DIR<span style=color:#66d9ef>)</span>/clients
</span></span><span style=display:flex><span>OVPN_TEMPLATE ?<span style=color:#f92672>=</span> <span style=color:#66d9ef>$(</span>OUTPUT_DIR<span style=color:#66d9ef>)</span>/client.ovpn.template
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>.PHONY: help client
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>help:
</span></span><span style=display:flex><span>	@echo <span style=color:#e6db74>&#34;Usage:&#34;</span>
</span></span><span style=display:flex><span>	@echo <span style=color:#e6db74>&#34;  make client CLIENT=&lt;client_name&gt;&#34;</span>
</span></span><span style=display:flex><span>	@echo <span style=color:#e6db74>&#34;    Generates an OpenVPN client configuration file for the specified client.&#34;</span>
</span></span><span style=display:flex><span>	@echo <span style=color:#e6db74>&#34;    If &lt;client_name&gt; is not provided, &#39;client1&#39; is used as the default.&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>client:
</span></span><span style=display:flex><span>	@mkdir -p <span style=color:#66d9ef>$(</span>OUTPUT_DIR<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	@<span style=color:#66d9ef>$(</span>EASYRSA_DIR<span style=color:#66d9ef>)</span>/easyrsa build-client-full <span style=color:#66d9ef>$(</span>CLIENT<span style=color:#66d9ef>)</span> nopass
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	@cat <span style=color:#66d9ef>$(</span>OVPN_TEMPLATE<span style=color:#66d9ef>)</span> &gt; <span style=color:#66d9ef>$(</span>OUTPUT_DIR<span style=color:#66d9ef>)</span>/<span style=color:#66d9ef>$(</span>CLIENT<span style=color:#66d9ef>)</span>.ovpn
</span></span><span style=display:flex><span>	@echo -e <span style=color:#e6db74>&#34;&lt;ca&gt;\n</span>$$<span style=color:#e6db74>(cat </span><span style=color:#66d9ef>$(</span>PKI_DIR<span style=color:#66d9ef>)</span><span style=color:#e6db74>/ca.crt)\n&lt;/ca&gt;\n&lt;cert&gt;\n</span>$$<span style=color:#e6db74>(cat </span><span style=color:#66d9ef>$(</span>PKI_DIR<span style=color:#66d9ef>)</span><span style=color:#e6db74>/issued/</span><span style=color:#66d9ef>$(</span>CLIENT<span style=color:#66d9ef>)</span><span style=color:#e6db74>.crt)\n&lt;/cert&gt;\n&lt;key&gt;\n</span>$$<span style=color:#e6db74>(cat </span><span style=color:#66d9ef>$(</span>PKI_DIR<span style=color:#66d9ef>)</span><span style=color:#e6db74>/private/</span><span style=color:#66d9ef>$(</span>CLIENT<span style=color:#66d9ef>)</span><span style=color:#e6db74>.key)\n&lt;/key&gt;\n&lt;tls-auth&gt;\n</span>$$<span style=color:#e6db74>(cat </span><span style=color:#66d9ef>$(</span>TA_KEY<span style=color:#66d9ef>)</span><span style=color:#e6db74>)\n&lt;/tls-auth&gt;&#34;</span> &gt;&gt; <span style=color:#66d9ef>$(</span>OUTPUT_DIR<span style=color:#66d9ef>)</span>/<span style=color:#66d9ef>$(</span>CLIENT<span style=color:#66d9ef>)</span>.ovpn
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	@echo <span style=color:#e6db74>&#34;Client configuration for </span><span style=color:#66d9ef>$(</span>CLIENT<span style=color:#66d9ef>)</span><span style=color:#e6db74> created at </span><span style=color:#66d9ef>$(</span>OUTPUT_DIR<span style=color:#66d9ef>)</span><span style=color:#e6db74>/</span><span style=color:#66d9ef>$(</span>CLIENT<span style=color:#66d9ef>)</span><span style=color:#e6db74>.ovpn&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>default: help
</span></span></code></pre></div><ol start=5><li>Save and exit</li></ol><p>Whenever you need to issue a new client configuration you can just run:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>make client CLIENT<span style=color:#f92672>=</span>&lt;name&gt;
</span></span></code></pre></div><p>If you forget the <code>make client CLIENT=&lt;name></code> command execution, just run <code>make</code> and it will
print you the help section.</p><h3 id=troubleshooting>Troubleshooting<a hidden class=anchor aria-hidden=true href=#troubleshooting>#</a></h3><ol><li>If you receive similar messages on the server side:</li></ol><pre tabindex=0><code>ovpn-server[460342]: Authenticate/Decrypt packet error: packet HMAC authentication failed
ovpn-server[460342]: TLS Error: incoming packet authentication failed from [AF_INET]&lt;remote_ip&gt;:&lt;remote_port&gt;
</code></pre><p>Most probably the client configuration around <code>tls-auth</code> is not configured correctly.
Make sure that the client <code>tls-auth</code> option is set to <code>1</code> and the server <code>tls-auth</code> is set to <code>0</code>.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://thetooth.io/tags/openvpn/>OpenVPN</a></li><li><a href=https://thetooth.io/tags/vpn/>VPN</a></li><li><a href=https://thetooth.io/tags/easyrsa/>EasyRSA</a></li><li><a href=https://thetooth.io/tags/security/>Security</a></li><li><a href=https://thetooth.io/tags/linux/>Linux</a></li></ul><nav class=paginav><a class=prev href=https://thetooth.io/blog/openvpn-server-automation/><span class=title>¬´ Prev</span><br><span>üöÄ Automating OpenVPN Server Setup with Ansible</span>
</a><a class=next href=https://thetooth.io/blog/slowloris-attack/><span class=title>Next ¬ª</span><br><span>ü¶• Slowloris Attack</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share üõ°Ô∏è Setting Up an OpenVPN Server with EasyRSA 3 on x" href="https://x.com/intent/tweet/?text=%f0%9f%9b%a1%ef%b8%8f%20Setting%20Up%20an%20OpenVPN%20Server%20with%20EasyRSA%203&amp;url=https%3a%2f%2fthetooth.io%2fblog%2fopenvpn-server-setup%2f&amp;hashtags=OpenVPN%2cVPN%2cEasyRSA%2cSecurity%2cLinux"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share üõ°Ô∏è Setting Up an OpenVPN Server with EasyRSA 3 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fthetooth.io%2fblog%2fopenvpn-server-setup%2f&amp;title=%f0%9f%9b%a1%ef%b8%8f%20Setting%20Up%20an%20OpenVPN%20Server%20with%20EasyRSA%203&amp;summary=%f0%9f%9b%a1%ef%b8%8f%20Setting%20Up%20an%20OpenVPN%20Server%20with%20EasyRSA%203&amp;source=https%3a%2f%2fthetooth.io%2fblog%2fopenvpn-server-setup%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share üõ°Ô∏è Setting Up an OpenVPN Server with EasyRSA 3 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fthetooth.io%2fblog%2fopenvpn-server-setup%2f&title=%f0%9f%9b%a1%ef%b8%8f%20Setting%20Up%20an%20OpenVPN%20Server%20with%20EasyRSA%203"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share üõ°Ô∏è Setting Up an OpenVPN Server with EasyRSA 3 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fthetooth.io%2fblog%2fopenvpn-server-setup%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share üõ°Ô∏è Setting Up an OpenVPN Server with EasyRSA 3 on whatsapp" href="https://api.whatsapp.com/send?text=%f0%9f%9b%a1%ef%b8%8f%20Setting%20Up%20an%20OpenVPN%20Server%20with%20EasyRSA%203%20-%20https%3a%2f%2fthetooth.io%2fblog%2fopenvpn-server-setup%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share üõ°Ô∏è Setting Up an OpenVPN Server with EasyRSA 3 on telegram" href="https://telegram.me/share/url?text=%f0%9f%9b%a1%ef%b8%8f%20Setting%20Up%20an%20OpenVPN%20Server%20with%20EasyRSA%203&amp;url=https%3a%2f%2fthetooth.io%2fblog%2fopenvpn-server-setup%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share üõ°Ô∏è Setting Up an OpenVPN Server with EasyRSA 3 on ycombinator" href="https://news.ycombinator.com/submitlink?t=%f0%9f%9b%a1%ef%b8%8f%20Setting%20Up%20an%20OpenVPN%20Server%20with%20EasyRSA%203&u=https%3a%2f%2fthetooth.io%2fblog%2fopenvpn-server-setup%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span><strong><a href=https://thetooth.io>thetooth.io</a></strong></span> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>